#!/usr/bin/env bash
set +x

# Start the Docker Daemon
#sudo chown idevopsio:docker /var/run/docker.sock
docker run -it -v /var/run/docker.sock:/var/run/docker.sock ubuntu:latest sh -c "apt-get update ; apt-get install docker.io -y ; bash"

ls -la /var/run/docker.sock

echo "Docker Host: ${DOCKER_HOST}"
export DOCKER_HOST_EXTERNAL="$DOCKER_HOST"
export DOCKER_HOST="tcp://127.0.0.1:2375"

service docker status
service docker start
sleep 60
service docker status

cd ${APPLICATION_PATH}

# Build Test and Main Image
echo "test"
docker build -t test .
echo "main"
docker build -t ${DOCKER_IMAGE_NAME} .


# Login to Remote Repository and Push
docker login ${DOCKER_HOST_EXTERNAL} --username ${DOCKER_USERNAME} --password ${DOCKER_PASSWORD}
docker push test
ls
cd ${APPLICATION_PATH}